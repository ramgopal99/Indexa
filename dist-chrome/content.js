(()=>{var B=Object.defineProperty;var D=(m,e,t)=>e in m?B(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var d=(m,e,t)=>D(m,typeof e!="symbol"?e+"":e,t);var v=class{constructor(e){d(this,"searchContainer",null);d(this,"searchInput",null);d(this,"isVisible",!1);d(this,"topics",[]);d(this,"filteredTopics",[]);d(this,"onFilterChange");this.onFilterChange=e,this.createContainer()}createContainer(){this.searchContainer=document.createElement("div"),this.searchContainer.className="search-container",this.searchContainer.id="search-container",this.searchContainer.style.display="none";let e=document.createElement("div");e.className="search-input-wrapper",this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.id="search-input",this.searchInput.className="search-input",this.searchInput.placeholder="Search topics...",this.searchInput.addEventListener("input",n=>{this.filterTopics(n.target.value)});let t=document.createElement("button");t.className="search-close-button",t.title="Close search",t.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 6 6 18"/>
        <path d="m6 6 12 12"/>
      </svg>
    `,t.addEventListener("click",()=>{this.toggle()}),e.appendChild(this.searchInput),e.appendChild(t),this.searchContainer.appendChild(e)}getContainer(){return this.searchContainer}setTopics(e){this.topics=e}toggle(){if(this.searchContainer)if(this.isVisible=!this.isVisible,this.isVisible)this.searchContainer.style.display="block",this.searchInput?.focus();else{this.searchContainer.style.display="none",this.searchInput&&(this.searchInput.value=""),this.filteredTopics=[];let e=this.topics.map(t=>({...t,highlightedText:void 0}));this.onFilterChange(e,!1)}}filterTopics(e){if(!e.trim()){this.filteredTopics=[];let n=this.topics.map(i=>({...i,highlightedText:void 0}));this.onFilterChange(n,!1);return}let t=e.toLowerCase();this.filteredTopics=this.topics.filter(n=>n.text.toLowerCase().includes(t)).map(n=>{let i=this.highlightText(n.text,e);return{...n,highlightedText:i}}),this.onFilterChange(this.filteredTopics,!0)}highlightText(e,t){if(!t.trim())return e;let n=new RegExp(`(${this.escapeRegExp(t)})`,"gi");return e.replace(n,'<span class="search-highlight">$1</span>')}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};var x=class{constructor(){d(this,"settingsDropdown",null);d(this,"currentTheme","light");d(this,"sidebarElement",null);d(this,"isDropdownOpen",!1);d(this,"studyModeEnabled",!1);d(this,"onStudyModeChange");this.loadSavedTheme(),this.loadStudyModeSettings()}setSidebarElement(e){this.sidebarElement=e,this.applyTheme()}toggleSettingsDropdown(e){this.settingsDropdown||this.createSettingsDropdown(),this.isDropdownOpen?this.hideSettingsDropdown():this.showSettingsDropdown(e)}showSettingsDropdown(e){this.settingsDropdown&&(this.isDropdownOpen=!0,this.settingsDropdown.classList.add("settings-dropdown-visible"),e&&this.positionDropdown(e))}hideSettingsDropdown(){this.settingsDropdown&&(this.isDropdownOpen=!1,this.settingsDropdown.classList.remove("settings-dropdown-visible"))}positionDropdown(e){if(!this.settingsDropdown)return;let t=e.getBoundingClientRect(),n=this.settingsDropdown.querySelector(".settings-dropdown");if(n){let a=Math.max(10,t.right-200-10),o=t.bottom+8;n.style.position="fixed",n.style.left=`${a}px`,n.style.top=`${o}px`,n.style.zIndex="10000"}}createSettingsDropdown(){if(this.settingsDropdown)return;let e=document.createElement("div");e.className="settings-dropdown-container";let t=document.createElement("div");t.className="settings-dropdown",this.currentTheme==="dark"&&t.classList.add("dark");let n=document.createElement("div");n.className="settings-dropdown-body";let i=document.createElement("div");i.className="settings-section";let a=document.createElement("button");a.className="theme-toggle-btn",a.textContent=this.currentTheme==="dark"?"\u2600\uFE0F Light Mode":"\u{1F319} Dark Mode",a.classList.toggle("dark-mode",this.currentTheme==="dark"),a.addEventListener("click",()=>{this.toggleTheme()}),i.appendChild(a),n.appendChild(i);let o=document.createElement("div");o.className="settings-section";let s=document.createElement("button");s.className="study-mode-toggle-btn",s.textContent=this.studyModeEnabled?"\u{1F4DA} Study Mode: ON":"\u{1F4D6} Study Mode: OFF",s.classList.toggle("study-mode-active",this.studyModeEnabled),s.addEventListener("click",()=>{this.toggleStudyMode()}),o.appendChild(s),n.appendChild(o),t.appendChild(n),e.appendChild(t),this.settingsDropdown=e,document.body.appendChild(e),setTimeout(()=>{document.addEventListener("click",this.handleClickOutside.bind(this))},0)}handleClickOutside(e){if(!this.settingsDropdown||!this.isDropdownOpen)return;let t=e.target,n=this.settingsDropdown.contains(t),i=document.querySelector(".settings-button"),a=i&&i.contains(t);!n&&!a&&this.hideSettingsDropdown()}loadSavedTheme(){let e=localStorage.getItem("side-indexer-theme");this.currentTheme=e||"light",this.applyTheme()}saveTheme(){localStorage.setItem("side-indexer-theme",this.currentTheme)}applyTheme(){if(this.sidebarElement&&(this.currentTheme==="dark"?this.sidebarElement.classList.add("dark"):this.sidebarElement.classList.remove("dark")),this.settingsDropdown){let e=this.settingsDropdown.querySelector(".settings-dropdown");e&&(this.currentTheme==="dark"?e.classList.add("dark"):e.classList.remove("dark"))}}toggleTheme(){this.currentTheme=this.currentTheme==="light"?"dark":"light",this.saveTheme(),this.applyTheme(),this.updateThemeToggleUI()}getCurrentTheme(){return this.currentTheme}updateThemeToggleUI(){if(!this.settingsDropdown)return;let e=this.settingsDropdown.querySelector(".theme-toggle-btn");if(e){let t=this.currentTheme==="dark";e.textContent=t?"\u2600\uFE0F Light Mode":"\u{1F319} Dark Mode",e.classList.toggle("dark-mode",t)}}loadStudyModeSettings(){let e=localStorage.getItem("side-indexer-study-mode")==="true";this.studyModeEnabled=e}saveStudyModeSettings(){localStorage.setItem("side-indexer-study-mode",this.studyModeEnabled.toString())}toggleStudyMode(){this.studyModeEnabled=!this.studyModeEnabled,this.saveStudyModeSettings(),this.updateStudyModeToggleUI(),this.onStudyModeChange?.(this.studyModeEnabled)}setStudyModeChangeCallback(e){this.onStudyModeChange=e}isStudyModeEnabled(){return this.studyModeEnabled}updateStudyModeToggleUI(){if(!this.settingsDropdown)return;let e=this.settingsDropdown.querySelector(".study-mode-toggle-btn");e&&(e.textContent=this.studyModeEnabled?"\u{1F4DA} Study Mode: ON":"\u{1F4D6} Study Mode: OFF",e.classList.toggle("study-mode-active",this.studyModeEnabled))}destroy(){this.settingsDropdown&&(document.body.removeChild(this.settingsDropdown),this.settingsDropdown=null),document.removeEventListener("click",this.handleClickOutside.bind(this))}};var w=class{constructor(e,t,n){d(this,"header",null);d(this,"search");d(this,"settings");this.search=e,this.settings=t,this.createHeader(n)}createHeader(e){this.header=document.createElement("div"),this.header.className="sidebar-header";let t=document.createElement("div");t.className="sidebar-header-left";let n=document.createElement("h2");n.className="sidebar-title",n.textContent="Indexa",t.appendChild(n);let i=document.createElement("div");i.className="sidebar-header-right";let a=document.createElement("button");a.className="sidebar-header-button search-button",a.title="Search",a.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.3-4.3"/>
      </svg>
    `,a.addEventListener("click",()=>{this.search.toggle()});let o=document.createElement("button");o.className="sidebar-header-button settings-button",o.title="Settings",o.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
    `,o.addEventListener("click",()=>{this.settings.toggleSettingsDropdown(o)});let s=document.createElement("button");s.className="sidebar-header-button close-button",s.title="Close sidebar",s.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 6 6 18"/>
        <path d="m6 6 12 12"/>
      </svg>
    `,s.addEventListener("click",e),i.appendChild(a),i.appendChild(o),i.appendChild(s),this.header.appendChild(t),this.header.appendChild(i)}getElement(){return this.header}};var y=class{constructor(e){d(this,"tabElement",null);d(this,"isActive",!0);this.createTab(e)}createTab(e){this.tabElement=document.createElement("button"),this.tabElement.className="sidebar-tab active",this.tabElement.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="14" height="14" fill="currentColor" style="margin-right: 4px; vertical-align: middle;">
        <path d="M 5 8 A 2.0002 2.0002 0 1 0 5 12 L 45 12 A 2.0002 2.0002 0 1 0 45 8 L 5 8 z M 5 23 A 2.0002 2.0002 0 1 0 5 27 L 45 27 A 2.0002 2.0002 0 1 0 45 23 L 5 23 z M 5 38 A 2.0002 2.0002 0 1 0 5 42 L 45 42 A 2.0002 2.0002 0 1 0 45 38 L 5 38 z"/>
      </svg>
      Menu
    `,this.tabElement.addEventListener("click",e)}setActive(e){this.isActive=e,this.tabElement&&(e?this.tabElement.classList.add("active"):this.tabElement.classList.remove("active"))}isTabActive(){return this.isActive}getElement(){return this.tabElement}};var k=class{constructor(e){d(this,"tabElement",null);d(this,"isActive",!1);this.createTab(e)}createTab(e){this.tabElement=document.createElement("button"),this.tabElement.className="sidebar-tab",this.tabElement.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;">
        <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/>
      </svg>
      Chat
    `,this.tabElement.addEventListener("click",e)}setActive(e){this.isActive=e,this.tabElement&&(e?this.tabElement.classList.add("active"):this.tabElement.classList.remove("active"))}isTabActive(){return this.isActive}getElement(){return this.tabElement}};var E=class{constructor(e,t){d(this,"tabsSection",null);d(this,"menuTab");d(this,"chatTab");d(this,"expandCollapseBtn",null);d(this,"viewMode","sections");d(this,"onViewModeChange");d(this,"onToggleExpandAll");this.onViewModeChange=e,this.onToggleExpandAll=t,this.menuTab=new y(()=>this.setViewMode("sections")),this.chatTab=new k(()=>this.setViewMode("chat")),this.createTabsSection()}createTabsSection(){this.tabsSection=document.createElement("div"),this.tabsSection.className="sidebar-tabs-section";let e=document.createElement("div");e.className="sidebar-tabs";let t=this.menuTab.getElement(),n=this.chatTab.getElement();t&&e.appendChild(t),n&&e.appendChild(n),this.expandCollapseBtn=document.createElement("button"),this.expandCollapseBtn.className="sidebar-expand-all-btn",this.expandCollapseBtn.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m9 18 6-6-6-6"/>
      </svg>
    `,this.expandCollapseBtn.title="Collapse All",this.expandCollapseBtn.addEventListener("click",()=>{this.onToggleExpandAll()}),this.tabsSection.appendChild(e),this.tabsSection.appendChild(this.expandCollapseBtn)}setViewMode(e){this.viewMode=e,e==="sections"?(this.menuTab.setActive(!0),this.chatTab.setActive(!1)):(this.menuTab.setActive(!1),this.chatTab.setActive(!0)),this.onViewModeChange(e)}getViewMode(){return this.viewMode}getElement(){return this.tabsSection}getExpandCollapseBtn(){return this.expandCollapseBtn}updateExpandCollapseButton(e){this.expandCollapseBtn&&(e?(this.expandCollapseBtn.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      `,this.expandCollapseBtn.title="Collapse All"):(this.expandCollapseBtn.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m6 9 6 6 6-6"/>
        </svg>
      `,this.expandCollapseBtn.title="Expand All"))}};var T=class{constructor(e,t){d(this,"tabsContainer");this.tabsContainer=new E(e,t)}getViewMode(){return this.tabsContainer.getViewMode()}getElement(){return this.tabsContainer.getElement()}getExpandCollapseBtn(){return this.tabsContainer.getExpandCollapseBtn()}updateExpandCollapseButton(e){this.tabsContainer.updateExpandCollapseButton(e)}};var L=class{constructor(e){d(this,"topicsList",null);d(this,"customLabels",new Map);d(this,"STORAGE_KEY","side-indexer-custom-labels");d(this,"STUDY_STORAGE_KEY","side-indexer-study-checked");d(this,"onLabelsChanged");d(this,"isStudyModeEnabled",!1);d(this,"studyCheckedTopics",new Set);this.onLabelsChanged=e,this.createTopicsList(),this.loadCustomLabels(),this.loadStudyCheckedTopics()}loadCustomLabels(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e);this.customLabels=new Map(Object.entries(t))}}catch(e){console.warn("Failed to load custom labels from localStorage:",e)}}saveCustomLabels(){try{let e=Object.fromEntries(this.customLabels);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.warn("Failed to save custom labels to localStorage:",e)}}getTopicKey(e){let t=e.type?`${e.type}:${e.text}`:`section:${e.text}`,n=Array.from(e.element.parentElement?.children||[]).indexOf(e.element);return`${t}:${n}`}setCustomLabel(e,t){let n=this.getTopicKey(e);t.trim()?this.customLabels.set(n,t.trim()):this.customLabels.delete(n),this.saveCustomLabels(),this.onLabelsChanged?.()}getCustomLabel(e){let t=this.getTopicKey(e);return this.customLabels.get(t)}setStudyMode(e,t,n){this.isStudyModeEnabled=e,this.updateTopicsList(t,n,!1)}isTopicChecked(e){let t=this.getTopicKey(e);return this.studyCheckedTopics.has(t)}toggleTopicChecked(e){let t=this.getTopicKey(e);this.studyCheckedTopics.has(t)?this.studyCheckedTopics.delete(t):this.studyCheckedTopics.add(t),this.saveStudyCheckedTopics()}loadStudyCheckedTopics(){try{let e=localStorage.getItem(this.STUDY_STORAGE_KEY);if(e){let t=JSON.parse(e);this.studyCheckedTopics=new Set(t)}}catch(e){console.warn("Failed to load study checked topics from localStorage:",e)}}saveStudyCheckedTopics(){try{let e=Array.from(this.studyCheckedTopics);localStorage.setItem(this.STUDY_STORAGE_KEY,JSON.stringify(e))}catch(e){console.warn("Failed to save study checked topics to localStorage:",e)}}createTopicsList(){this.topicsList=document.createElement("div"),this.topicsList.className="topics-list",this.topicsList.id="topics-list",this.topicsList.innerHTML='<div class="no-topics">No topics found yet</div>'}updateTopicsList(e,t,n=!1){if(!this.topicsList)return;if(e.length===0){this.topicsList.innerHTML='<div class="no-topics">No topics found yet</div>';return}let i=t==="chat"?e.filter(o=>o.type==="user"||o.type==="ai"):e.filter(o=>!o.type);console.log("Total topics found:",e.length),console.log("Filtered topics for",t,":",i.length),console.log("Chat topics:",e.filter(o=>o.type==="user"||o.type==="ai").length),console.log("Section topics:",e.filter(o=>!o.type).length);let a=new Array(i.length).fill(!1);for(let o=0;o<i.length;o++){let s=i[o].level;for(let r=o+1;r<i.length&&!(i[r].level<=s);r++)if(i[r].level===s+1){a[o]=!0;break}}this.topicsList.innerHTML=i.map((o,s)=>{let r=a[s],p=(o.level-1)*20,h=this.isStudyModeEnabled&&t==="sections",c=r?'<span class="expand-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg></span>':h||t==="chat"?"":'<span class="expand-icon-placeholder"></span>',b=t==="chat"&&o.type?o.type==="user"?"You:":"AI:":`H${o.level}`,l=this.getCustomLabel(o),u=o.highlightedText||l||o.text,H=this.isTopicChecked(o),A=h?`<input type="checkbox" class="study-checkbox" ${H?"checked":""} data-topic-index="${s}">`:"",I=h?(h?r?29:36:0)+p:p;return`
      <div class="topic-item ${r?"has-children expanded":""} ${o.type||""} ${n?"search-result":""}" data-index="${s}" data-level="${o.level}">
        ${A}
        <div class="topic-text" style="padding-left: ${I}px;">
          ${c}
          <span class="heading-label h${o.level} ${o.type||""}">${b}</span>
          <span class="topic-content">${u}</span>
        </div>
      </div>
    `}).join(""),i.forEach((o,s)=>{let r=this.topicsList?.querySelector(`[data-index="${s}"]`);if(!r)return;let p=r.querySelector(".expand-icon");a[s]&&p&&p.addEventListener("click",b=>{b.stopPropagation(),r.classList.contains("expanded")?(r.classList.remove("expanded"),p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>',this.hideChildren(s,o.level)):(r.classList.add("expanded"),p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>',this.showChildren(s,o.level))}),r.addEventListener("click",b=>{b.target.classList.contains("expand-icon")||b.target.classList.contains("study-checkbox")||(o.element.scrollIntoView({behavior:"smooth",block:"center"}),o.element.classList.add("side-indexer-highlight"),setTimeout(()=>{o.element.classList.add("fade-out"),setTimeout(()=>{o.element.classList.remove("side-indexer-highlight","fade-out")},500)},1500))});let c=r.querySelector(".topic-text");if(c&&c.addEventListener("dblclick",b=>{b.stopPropagation(),this.startInlineEditing(r,o)}),this.isStudyModeEnabled&&t==="sections"){let b=r.querySelector(".study-checkbox");b&&(b.addEventListener("change",l=>{l.stopPropagation(),this.toggleTopicChecked(o)}),b.addEventListener("click",l=>{l.stopPropagation()}))}})}hideChildren(e,t){if(!this.topicsList)return;this.topicsList.querySelectorAll(".topic-item").forEach((i,a)=>{if(a>e)if(parseInt(i.dataset.level||"1")>t){let s=i;s.style.display="none"}else return})}showChildren(e,t){if(!this.topicsList)return;let n=this.topicsList.querySelectorAll(".topic-item");n.forEach((i,a)=>{if(a>e){let o=parseInt(i.dataset.level||"1"),s=i;if(o<=t)return;if(o===t+1){if(s.style.display="",s.classList.contains("has-children")&&!s.classList.contains("expanded")){s.classList.add("expanded");let r=s.querySelector(".expand-icon");r&&(r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>')}}else if(o>t+1){let r=!0,p=o-1,h=a-1;for(;p>t&&h>=0;){let c=n[h];if(parseInt(c.dataset.level||"1")===p){if(!c.classList.contains("expanded")){r=!1;break}p--}h--}if(r){if(s.style.display="",s.classList.contains("has-children")&&!s.classList.contains("expanded")){s.classList.add("expanded");let c=s.querySelector(".expand-icon");c&&(c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>')}}else s.style.display="none"}}})}toggleExpandAll(e){if(!this.topicsList)return;let t=Array.from(this.topicsList.querySelectorAll(".topic-item.has-children"));e?t.forEach(n=>{let i=n;i.classList.remove("expanded");let a=i.querySelector(".expand-icon");a&&(a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>');let o=parseInt(i.dataset.level||"1"),s=parseInt(i.dataset.index||"0");this.hideChildren(s,o)}):t.forEach(n=>{let i=n;i.classList.add("expanded");let a=i.querySelector(".expand-icon");a&&(a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>');let o=parseInt(i.dataset.level||"1"),s=parseInt(i.dataset.index||"0");this.showChildren(s,o)})}startInlineEditing(e,t){let i=e.querySelector(".topic-text").querySelector(".topic-content");if(!i)return;let a=this.getCustomLabel(t)||t.text;i.contentEditable="true",i.style.outline="none",i.style.border="1px solid #007acc",i.style.borderRadius="3px",i.style.padding="2px 4px",i.style.backgroundColor="white",i.style.minWidth="50px",i.style.display="inline-block";let o=window.getSelection(),s=document.createRange();s.selectNodeContents(i),o?.removeAllRanges(),o?.addRange(s),e.classList.add("editing");let r=()=>{this.saveInlineEdit(i,t,e)},p=c=>{c.key==="Enter"?(c.preventDefault(),i.blur()):c.key==="Escape"&&(c.preventDefault(),i.textContent=a,i.blur())};i.addEventListener("blur",r),i.addEventListener("keydown",p);let h=i;h._blurHandler=r,h._keydownHandler=p,i.focus()}saveInlineEdit(e,t,n){let i=e.textContent?.trim()||"";e.contentEditable="false",e.style.outline="",e.style.border="",e.style.borderRadius="",e.style.padding="",e.style.backgroundColor="",e.style.minWidth="",e.style.display="",n.classList.remove("editing"),i&&i!==t.text?this.setCustomLabel(t,i):i?i===t.text&&this.setCustomLabel(t,""):(e.textContent=t.text,this.setCustomLabel(t,""));let a=e;a._blurHandler&&e.removeEventListener("blur",a._blurHandler),a._keydownHandler&&e.removeEventListener("keydown",a._keydownHandler)}getElement(){return this.topicsList}};var C=class{constructor(){d(this,"sidebar",null);d(this,"topics",[]);d(this,"observer",null);d(this,"search");d(this,"settings");d(this,"viewMode","sections");d(this,"allExpanded",!0);d(this,"sidebarHeader");d(this,"sidebarTabs");d(this,"sidebarTopicsList");this.search=new v((e,t=!1)=>{this.updateTopicsList(e.length>0?e:this.topics,t)}),this.settings=new x,this.sidebarHeader=new w(this.search,this.settings,()=>this.hideSidebar()),this.sidebarTabs=new T(e=>this.handleViewModeChange(e),()=>this.toggleExpandAll()),this.sidebarTopicsList=new L(()=>{this.updateTopicsList(this.topics,!1)}),this.sidebarTopicsList.setStudyMode(this.settings.isStudyModeEnabled(),this.topics,this.viewMode),this.settings.setStudyModeChangeCallback(e=>{this.sidebarTopicsList.setStudyMode(e,this.topics,this.viewMode)})}initialize(){this.sidebar=document.createElement("div"),this.sidebar.className="side-indexer-sidebar";let e=this.sidebarHeader.getElement();e&&this.sidebar.appendChild(e);let t=this.sidebarTabs.getElement();t&&this.sidebar.appendChild(t);let n=this.search.getContainer();n&&this.sidebar.appendChild(n);let i=this.sidebarTopicsList.getElement();i&&this.sidebar.appendChild(i),document.body.appendChild(this.sidebar),this.sidebarTabs.updateExpandCollapseButton(this.allExpanded),setTimeout(()=>{this.sidebar&&(this.sidebar.classList.add("sidebar-visible"),this.settings.setSidebarElement(this.sidebar)),document.body.classList.add("sidebar-active")},1e3),this.scanForTopics()}handleViewModeChange(e){this.viewMode=e,this.updateTopicsList(this.topics,!1)}observeChatChanges(){let e=null;window.location.hostname==="claude.ai"?e=document.querySelector('[data-testid="conversation-main"]')||document.querySelector('[data-scroller="true"]')||document.querySelector(".conversation-container")||document.querySelector(".flex.flex-col.gap-3")||document.querySelector(".flex.flex-col.items-start")||document.querySelector('[role="main"]')||document.body:e=document.querySelector('[data-testid="conversation-turn"]')?.parentElement||document.querySelector(".flex.flex-col")||document.querySelector('[data-testid="conversation-list"]')||document.querySelector(".conversation-container")||document.querySelector("#conversation-container")||document.body,console.log("Chat container found:",e?e.tagName:"none","on site:",window.location.hostname),e&&(this.observer=new MutationObserver(t=>{let n=!1;t.forEach(i=>{i.type==="childList"&&i.addedNodes.length>0&&(n=!0)}),n&&(console.log("Chat changes detected, scanning for topics..."),this.scanForTopics())}),this.observer.observe(e,{childList:!0,subtree:!0,characterData:!1}),setTimeout(()=>this.scanForTopics(),500))}scanForTopics(){console.log("\u{1F50D} Scanning for topics on:",window.location.hostname),this.topics=[];let e;if(window.location.hostname==="claude.ai"){let i=document.querySelectorAll('[data-testid*="message"], [data-message-id], .group[data-message-id]');i.length===0&&(i=document.querySelectorAll('[class*="font-user-message"], [class*="font-claude-message"], [class*="font-assistant-message"]')),console.log(`Found ${i.length} Claude message containers`);let a=new Set;i.forEach(o=>{let s=[".prose",".whitespace-pre-wrap","p","div","span"];for(let r of s)o.querySelectorAll(r).forEach(h=>{let c=h.textContent?.trim();c&&c.length>10&&!c.includes("Sonnet")&&!c.includes("model")&&!c.includes("Claude.ai")&&!c.includes("Save")&&!c.includes("Copy")&&!c.includes("Regenerate")&&a.add(h)});if(o.querySelectorAll(".prose, .whitespace-pre-wrap, p, div, span").length===0){let r=o.textContent?.trim();r&&r.length>10&&!r.includes("Sonnet")&&!r.includes("model")&&!r.includes("Save")&&!r.includes("Copy")&&a.add(o)}}),e=Array.from(a),console.log(`Extracted ${e.length} Claude content elements`)}else if(e=document.querySelectorAll('[data-testid="conversation-turn"]'),e.length===0){let i=["[data-message-author-role]",".message",".conversation-message",'[role="message"]',".user-message",".assistant-message","[data-message-role]",".chat-message",".message-wrapper",".conversation-item"];for(let a of i)if(e=document.querySelectorAll(a),e.length>0){console.log(`Found ${e.length} conversation elements using selector: ${a}`);break}}else console.log("Found conversation turns:",e.length);let t=new Set;e.forEach(i=>{let a=!1,o=!1,s=i.textContent?.trim()||"";if(!t.has(s)){if(window.location.hostname==="claude.ai"){let r=i;i.matches('[data-testid*="message"], [data-message-id], [class*="font-user-message"], [class*="font-claude-message"]')||(r=i.closest('[data-testid*="message"], [data-message-id], [class*="font-user-message"], [class*="font-claude-message"]')||i);let p=r.getAttribute("data-message-role"),h=r.getAttribute("data-is-user-message"),c=r.getAttribute("data-message-id"),b=r.className;if((p==="user"||h==="true"||b.includes("font-user-message")||r.matches('[class*="font-user-message"]'))&&(a=!0),(p==="assistant"||h==="false"||b.includes("font-claude-message")||b.includes("font-assistant-message")||r.matches('[class*="font-claude-message"]')||r.matches('[class*="font-assistant-message"]'))&&(o=!0),!a&&!o){let l=s.toLowerCase(),u=i.className.toLowerCase();u.includes("font-user-message")||u.includes("user-message")?a=!0:u.includes("font-claude-message")||u.includes("font-assistant-message")||u.includes("claude-message")||u.includes("assistant-message")?o=!0:s&&s.length>10&&(l.length<50&&(l.includes("sonnet")||l.includes("claude.ai")||l.includes("model")||l.includes("save")||l.includes("copy")||l.includes("regenerate"))?console.log("Skipping likely header/metadata:",s.substring(0,30)+"..."):l.includes("i'm claude")||l.includes("as claude")||l.includes("here's")||l.includes("i'll help")||l.includes("i can help")||l.includes("let me")||l.includes("i'd be happy to")||l.includes("claude")&&l.length>100?o=!0:(l.includes("you said:")||l.includes("you:")||l.length<500&&!l.includes("here's")&&!l.includes("i'll")&&!l.includes("i can"))&&(a=!0))}(a||o)&&console.log(`Claude message detected - ${a?"USER":"AI"}:`,{role:p,isUserMessage:h,messageId:c,classes:i.className,preview:s.substring(0,50)+"..."})}else if((i.querySelector('[data-message-author-role="user"]')||i.querySelector('[data-message-role="user"]')||i.classList.contains("user")||i.closest('[data-message-author-role="user"]')||s.includes("You :")||i.getAttribute("data-message-author-role")==="user")&&(a=!0),(i.querySelector('[data-message-author-role="assistant"]')||i.querySelector('[data-message-role="assistant"]')||i.classList.contains("assistant")||i.closest('[data-message-author-role="assistant"]')||s.includes("Assistant:")||s.includes("AI :")||i.getAttribute("data-message-author-role")==="assistant")&&(o=!0),!a&&!o&&s){let r=s.toLowerCase();r.includes("you:")||r.includes("user:")||r.includes("human:")?a=!0:(r.includes("assistant:")||r.includes("ai:")||r.includes("bot:"))&&(o=!0)}if(a||o){let r;window.location.hostname==="claude.ai"?r=["You said:","You:","Claude:","Assistant:","Human:","User:","AI:","Assistant:","Bot:","Claude AI:"]:r=["You:","Assistant:","User:","AI:","Human:","Assistant:","Bot:"];for(let h of r)if(s.toLowerCase().startsWith(h.toLowerCase())){s=s.substring(h.length).trim();break}let p=s.length>60?s.substring(0,60)+"...":s||"Empty message";console.log(`Found ${a?"user":"AI"} message:`,p.substring(0,30)+"..."),this.topics.push({text:p,level:1,element:i,type:a?"user":"ai"}),t.add(s)}}});let n;window.location.hostname==="claude.ai"?n=document.querySelectorAll('[data-message-role], [data-testid="conversation-turn"], .group, .markdown, .message-container, [data-message-id]'):n=document.querySelectorAll('[data-testid="conversation-turn"], .group, .markdown'),n.forEach(i=>{i.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(o=>{let s=o.textContent?.trim();if(s&&s.length>2&&s.length<100){let r=parseInt(o.tagName.charAt(1))||1;this.topics.push({text:s,level:r,element:o})}})}),this.topics.length===0&&(document.body.textContent||"").split(`
`).forEach(o=>{let s=o.trim();if(s.length>5&&s.length<100){let r=s.match(/^(#{1,6})\s+(.+)$/);r&&this.topics.push({text:r[2],level:r[1].length,element:document.body})}}),this.topics=this.topics.filter((i,a,o)=>a===o.findIndex(s=>s.text===i.text)).slice(0,25),this.updateTopicsList(this.topics,!1),this.search.setTopics(this.topics)}updateTopicsList(e,t=!1){this.sidebarTopicsList.updateTopicsList(e,this.viewMode,t)}showSidebar(){this.sidebar&&(this.sidebar.classList.add("sidebar-visible"),document.body.classList.add("sidebar-active"))}hideSidebar(){this.sidebar&&(this.sidebar.classList.remove("sidebar-visible"),document.body.classList.remove("sidebar-active"))}isSidebarVisible(){return this.sidebar?.classList.contains("sidebar-visible")||!1}manualScan(){console.log("Manual scan triggered"),this.scanForTopics()}debugClaude(){console.log("\u{1F527} Claude.ai Debug Information:"),console.log("Current hostname:",window.location.hostname),console.log("Available selectors:"),["[data-message-role]",'[data-testid*="message"]',".group[data-message-id]",".font-user-message",".font-claude-message",".font-assistant-message",'[class*="font-user-message"]','[class*="font-claude-message"]','[class*="font-assistant-message"]',".prose",".whitespace-pre-wrap",'[class*="prose"]','[class*="whitespace-pre-wrap"]',"[data-is-user-message]",".message-container",'div[role="group"]','div[class*="message"]'].forEach(t=>{let n=document.querySelectorAll(t);if(n.length>0){console.log(`\u2705 ${t}: ${n.length} elements found`);let i=n[0];console.log("   First element:",{tagName:i.tagName,className:i.className,attributes:Array.from(i.attributes).map(a=>`${a.name}="${a.value}"`),textPreview:i.textContent?.substring(0,100)+"..."})}else console.log(`\u274C ${t}: 0 elements found`)}),console.log("Current topics found:",this.topics.length),this.topics.forEach((t,n)=>{console.log(`${n+1}. ${t.type}: ${t.text.substring(0,50)}...`)})}toggleExpandAll(){this.allExpanded?(this.sidebarTopicsList.toggleExpandAll(!0),this.allExpanded=!1,this.sidebarTabs.updateExpandCollapseButton(!1)):(this.sidebarTopicsList.toggleExpandAll(!1),this.allExpanded=!0,this.sidebarTabs.updateExpandCollapseButton(!0))}};var f=window.browser||chrome,ve=f.tabs,M=f.runtime,xe=f.storage,we=f.scripting,ye=f.action;var S=class{constructor(){d(this,"sidebar");this.sidebar=new C,this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.sidebar.initialize(),this.sidebar.observeChatChanges()}):(this.sidebar.initialize(),this.sidebar.observeChatChanges())}showSidebar(){this.sidebar.showSidebar()}hideSidebar(){this.sidebar.hideSidebar()}isSidebarVisible(){return this.sidebar.isSidebarVisible()}},g=new S;M.onMessage.addListener((m,e,t)=>(m.action==="toggleSidebar"?(g.isSidebarVisible()?g.hideSidebar():g.showSidebar(),t({visible:g.isSidebarVisible()})):m.action==="getSidebarState"?t({visible:g.isSidebarVisible()}):m.action==="showSidebar"&&(g.showSidebar(),t({visible:!0})),!0));})();
